installatian based on microk8s:

Voraussetzung: Ubuntu 18.04 mit 16 GB RAM

Randbedingungen: korrekte SSL-Zertifikate sind kein Ziel

snap install microk8s --classic
snap alias microk8s.kubectl kubectl
microk8s.enable dns
microk8s.enable ingress
microk8s.enable metrics-server
microk8s.enable storage

kubectl create secret docker-registry quay.io --docker-server=quay.io --docker-username=<login> --docker-password=<password>
kubectl create secret docker-registry gitlab.westernacher.com --docker-server=registry.gitlab.westernacher.com --docker-username=<login> --docker-password=<password>
kubectl patch serviceaccount default -p '{"imagePullSecrets": [{"name": "quay.io"},{"name": "gitlab.westernacher.com"}]}'

kubectl run -it --rm alfresco-installer --image registry.gitlab.westernacher.com/torsten.werner/acs-deployment/alfresco-installer:0.1 --image-pull-policy Always --restart Never -- --set externalProtocol="https" --set externalHost="95.217.1.233" --set externalPort="443"

kubectl get pods --watch

  Share: https://95.217.1.233:443/share
  Content: https://95.217.1.233:443/alfresco
  Api-Explorer: https://95.217.1.233:443/api-explorer

Images auflisten:

kubectl get pods -o jsonpath='{.items[*].spec.containers[*].image}'

# from enterprise repo
quay.io/alfresco/alfresco-imagemagick:2.0.17
quay.io/alfresco/alfresco-libreoffice:2.0.17
quay.io/alfresco/alfresco-pdf-renderer:2.0.17
quay.io/alfresco/alfresco-tika:2.0.17
quay.io/alfresco/alfresco-transform-router:1.0.2.1

# from public docker hub
alfresco/alfresco-activemq:5.15.8-java-8-oracle-centos-7-87b15e37ce8b
alfresco/alfresco-content-repository:6.1.0
alfresco/alfresco-share:6.1.0
alfresco/alfresco-shared-file-store:0.5.3
alfresco/alfresco-search-services:1.3.0.1
postgres:10.1

# from microk8s.enable ingress
quay.io/kubernetes-ingress-controller/nginx-ingress-controller-amd64:0.22.0
gcr.io/google_containers/defaultbackend-amd64:1.4


# import both BNotK certificates from https://wiki.westernacher.com/x/hg9WAw into local keystore, edit trust settings for ssl, and restart docker

docker login -u vpn-werner westernacher-docker.artifactory.test.bnotk.net

# copy images – target names must start with prefix com.westernacher:

docker pull quay.io/alfresco/alfresco-transform-router:1.0.2.1
docker tag quay.io/alfresco/alfresco-transform-router:1.0.2.1 westernacher-docker.artifactory.test.bnotk.net/com.westernacher.alfresco-transform-router:1.0.2.1
docker push westernacher-docker.artifactory.test.bnotk.net/com.westernacher.alfresco-transform-router:1.0.2.1
